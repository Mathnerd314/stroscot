<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Core syntax &mdash; Stroscot  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/hexagon_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dispatch" href="Dispatch.html" />
    <link rel="prev" title="Concurrency" href="Concurrency.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/hexagon_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HowTo/index.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/index.html">Language Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Commentary</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Assembly.html">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="BuildSystem.html">Build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="Checklist.html">Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="Code-Generation.html">Code generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Compiler.html">Compiler design</a></li>
<li class="toctree-l2"><a class="reference internal" href="Compiler-Library.html">Compiler library</a></li>
<li class="toctree-l2"><a class="reference internal" href="CompilerOutput.html">Compiler output</a></li>
<li class="toctree-l2"><a class="reference internal" href="Concurrency.html">Concurrency</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Core syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#derivation-tree">Derivation tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nets">Nets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expression-graph">Expression graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bad-syntax">Bad syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#better-syntax">Better syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#real-syntax">Real syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#c2-syntax">C2 syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#normal-order-reduction">Normal Order Reduction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cut-elimination">Cut elimination</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Dispatch.html">Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="Errors.html">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="Evaluation-Strategy.html">Evaluation strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="Exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fastest.html">As fast as C</a></li>
<li class="toctree-l2"><a class="reference internal" href="IR.html">Intermediate representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Intrinsics.html">Intrinsics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Learning.html">Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Logic.html">Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="LogicProgramming.html">Logic programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="Memory-Management.html">Memory management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Meta.html">Meta</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="Objects.html">Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="PackageManager.html">Package manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="Parsing.html">Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Posets.html">Posets</a></li>
<li class="toctree-l2"><a class="reference internal" href="Profiling.html">Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Programs.html">Exemplary programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reduction.html">Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reduction-Example.html">Reduction example</a></li>
<li class="toctree-l2"><a class="reference internal" href="Resource-Management.html">Resource management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sets.html">Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="Standard-Library.html">Standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="State.html">Stateful programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Syntax.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="TermRewriting.html">Term rewriting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Time.html">Time API</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="Types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="Units.html">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="Verification.html">Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../zzreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Stroscot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Commentary</a></li>
      <li class="breadcrumb-item active">Core syntax</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/Mathnerd314/stroscot/edit/master/docs/Commentary/CoreSyntax.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="core-syntax">
<h1>Core syntax<a class="headerlink" href="#core-syntax" title="Permalink to this heading"></a></h1>
<p>Stroscot takes after Haskell in that all of the language is compiled to a smallish core language. This makes it easier to implement code transformations and new backends. Proofs are programs by the Curry-Howard correspondence, so the core is the jumbo two-sided linear logic sequent calculus. Reduction of this core corresponds to cut elimination - the normal forms (values) are cut-free terms.
But we need a syntax for all the proofs.</p>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h2>
<p>We use a simple program, boolean “and”, presented in a Haskell-ish language:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">and</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nf">\</span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">False</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="nf">\</span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">False</span><span class="p">;</span><span class="w"> </span><span class="kt">True</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="nf">\</span><span class="n">y</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>
<span class="nf">r</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="kt">False</span><span class="w"> </span><span class="kt">True</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Bool</span>
</pre></div>
</div>
<section id="derivation-tree">
<h3>Derivation tree<a class="headerlink" href="#derivation-tree" title="Permalink to this heading"></a></h3>
<p>See the connectives <span class="math notranslate nohighlight">\(\text{B} = \text{Bool}\)</span> and <span class="math notranslate nohighlight">\(\multimap\)</span> defined <span class="xref std std-ref">above</span>. <span class="math notranslate nohighlight">\(\multimap\)</span> is right associative as usual. Our program then has the following derivation tree, among others (we could add a bang to the first argument, use a multiple-argument function instead of currying, expand out the identity, etc.).</p>
<img alt="../_images/Stroscot_AND_Proof_Tree.svg" src="../_images/Stroscot_AND_Proof_Tree.svg" /><p>The derivation tree representation suffers from what Girard calls “bureaucratic problems of transposing rules” (<span id="id1">[<a class="reference internal" href="../zzreferences.html#id65" title="Jean-Yves Girard. Towards a geometry of interaction. In J. W. Gray and A. Scedrov, editors, Categories in Computer Science and Logic, volume 92 of Contemporary Mathematics, 69–108. University of Colorado in Boulder, 1989. American Mathematical Society. Proceedings of the AMS-IMS-SIAM Joint Summer Research Conference, June 14–20, 1987, Boulder, Colorado; Contemporary Mathematics Volume 92. URL: https://jb55.com/linear/pdf/Towards%20a%20geometry%20of%20interaction.pdf.">Gir89</a>]</span>, page 30 / 98). Girard’s example is based on cut elimination; but it is also visible in the specification of the proof tree as rule reordering. For example the cuts on <span class="math notranslate nohighlight">\(\Sigma_{F R}\)</span> and “Use and” can be swapped without changing the meaning. The derivation tree is also ambiguous in that rule invocations with a sequent like <span class="math notranslate nohighlight">\(A, A \vdash B\)</span> are ambiguous as to which proposition <span class="math notranslate nohighlight">\(A\)</span> is used - this isn’t resolved by using the exchange rule as then exchange on <span class="math notranslate nohighlight">\(A, A, A \vdash B\)</span> is ambiguous as to which pair of formulas was swapped.</p>
</section>
<section id="nets">
<h3>Nets<a class="headerlink" href="#nets" title="Permalink to this heading"></a></h3>
<p>We can split up the derivation tree into a graph, where each node is a rule instance (the vertical bar in the derivation tree) and the syntactic subderivation relationship is a black edge.</p>
<img alt="../_images/AND_net.svg" src="../_images/AND_net.svg" /><img alt="../_images/AND_net_r.svg" src="../_images/AND_net_r.svg" /><p>To solve the bureaucratic problems there is another set of connecting edges, the red/blue edges in the graph. The edges are each proposition’s introduction/elimination (highest and lowest usage). Exchange rules can be omitted because we reference the propositions directly. The color is for clarity - a proposition on the left (antecedent) is blue and likewise right (succedent) is red. In the code each edge is identified as a unique variable in a slot, so there is no coloring. But depicting n-ary ports in a visual way without ambiguity seems hard.</p>
<p>Most rules do not modify the contexts <span class="math notranslate nohighlight">\(\Gamma, \Delta, \Theta, \Lambda\)</span> and so the proposition edge skips the node as it is not an introduction/elimination (gray in the presentation above). But there are exceptions that do need the context:</p>
<blockquote>
<div><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Pi_R\)</span> and <span class="math notranslate nohighlight">\(\Sigma_L\)</span> rename and combine the context from each case, similar to a phi-node. This can be skipped if there’s exactly one case.</p></li>
<li><p>Exponential promotion defines a box around a subtree of the derivation, and the box edge must be clearly defined so we can duplicate/erase it properly, so we keep the context there.</p></li>
<li><p>Use/Assign, so that substitution has something to work with and the free variables are identified</p></li>
</ul>
</div></blockquote>
</section>
<section id="expression-graph">
<h3>Expression graph<a class="headerlink" href="#expression-graph" title="Permalink to this heading"></a></h3>
<p>The syntactic subderivation inclusion relationship is somewhat redundant in that we can reconstruct it from the blue/red edges, at least up to cut permutation. If we drop the syntactic inclusion relationship, reverse the directions of the blue edges, and drop the sequents, then the graph looks much more like your traditional expression tree. In particular cuts and identities become straight edges rather than top/bottom. PiL is an application node, PiR is a lambda, SigmaL is case, and SigmaR is a constructor (depicted in the graph as True/False).</p>
<div class="graphviz"><object data="../_images/graphviz-301962cf497189e907736cbef943b8ad6b2dbbd9.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph {
and [label=&quot;and =&quot;]
and -&gt; d [color=&quot;red&quot;]

d [label=&quot;PiR&quot;]
e -&gt; d [color=&quot;blue&quot;,dir=back]
d -&gt; e /* f */ [color=&quot;red&quot;]
e [label=&quot;SigmaL&quot;]
e -&gt; f1 [color=&quot;red&quot;]
e -&gt; f2 [color=&quot;red&quot;]
f1 [label=&quot;PiR&quot;]
g1 -&gt; f1 [color=&quot;blue&quot;,dir=back]
f1 -&gt; h1 [color=&quot;red&quot;]
g1 [label=&quot;!w&quot;]
h1 [label=&quot;False&quot;]
f2 [label=&quot;PiR&quot;]
g2 -&gt; f2 [color=&quot;blue&quot;,dir=back]
f2 -&gt; h2 /* h2r */ [color=&quot;red&quot;]
g2 [label=&quot;!d&quot;]
h2 -&gt; g2 [color=&quot;blue&quot;,dir=back]
h2 [label=&quot;I&quot;]
}</p></object></div>
<div class="graphviz"><object data="../_images/graphviz-f7e3261b4ea383f66f8fda6dd0701fd10c247c93.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph {
r [label=&quot;r =&quot;]
r -&gt; p /* pr */ [color=&quot;red&quot;]
c1 [label=&quot;Cut&quot;]
c1 -&gt; a [color=&quot;red&quot;]
n -&gt; c1 [color=&quot;blue&quot;,dir=back]
a [label=&quot;!&quot;]
a -&gt; b [color=&quot;red&quot;]
b [label=&quot;True&quot;]
c2 [label=&quot;Cut&quot;]
c2 -&gt; l /* lr */ [color=&quot;red&quot;]
m -&gt; c2 [color=&quot;blue&quot;,dir=back]
c3 [label=&quot;Cut&quot;]
c3 -&gt; c [color=&quot;red&quot;]
k -&gt; c3 [color=&quot;blue&quot;,dir=back]
c [label=&quot;False&quot;]
c4 [label=&quot;Cut&quot;]
c4 -&gt; d2 [color=&quot;red&quot;]
j -&gt; c4 [color=&quot;blue&quot;,dir=back]
d2 [label=&quot;Use and&quot;]

j [label=&quot;PiL&quot;]
j -&gt; k /* kr */ [color=&quot;red&quot;]
l -&gt; j [color=&quot;blue&quot;,dir=back]
k [label=&quot;I&quot;]
l [label=&quot;I&quot;]
m [label=&quot;PiL&quot;]
m -&gt; n /* nr */ [color=&quot;red&quot;]
p -&gt; m [color=&quot;blue&quot;,dir=back]
n [label=&quot;I&quot;]
p [label=&quot;I&quot;]
}</p></object></div>
<p>The identity nodes function like thunk identifiers; the stuff in between the identity and the cut on the blue edges is like the stack of the thunk. An I right next to a Cut is a no-op so for example the 2 blue Cut-I edges above the True and False and the red Cut-I edge above the PiL in the <code class="docutils literal notranslate"><span class="pre">r=</span></code> expression can be squinched together. Then the path from the assignment node to the use node reads “push !True to stack, push False to stack, reduce with and” (recall the original expression was <code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">False</span> <span class="pre">True</span></code>).</p>
</section>
<section id="bad-syntax">
<h3>Bad syntax<a class="headerlink" href="#bad-syntax" title="Permalink to this heading"></a></h3>
<p>The bad syntax serializes the non-simplified net into a textual form by writing each node using Haskell’s datatype syntax. You can see the datatypes in <a class="reference external" href="https://github.com/Mathnerd314/stroscot/blob/fb648be1ecc3e5c062dbb000d6887a2ce7ac7eb0/src/Core.hs#L50">Core.hs</a>. Each edge has a unique identifier, and the nodes are nameless. The order of the nodes is arbitrary. We should also write out the types of the formulas (blue/red edges), so they can be used to reconstruct the full sequent as in the presentation above. But for now Core is untyped, so there is only one universal type and the types of the edges are not written out.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">Identity</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">,</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;iseq83&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;iret84&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;ret82&quot;</span><span class="p">}})</span>
<span class="kt">BangD</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;iseq83&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;iret84&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">},</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;seq80&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;i81&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">}}),</span>
<span class="kt">PiR</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[(</span><span class="kt">Tag</span><span class="w"> </span><span class="s">&quot;func&quot;</span><span class="p">,</span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;seq80&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">[]</span><span class="p">,[</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;i81&quot;</span><span class="p">]),</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">([</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;ret82&quot;</span><span class="p">],</span><span class="kt">[]</span><span class="p">)})],</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;c_bseq79&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;newrretf78&quot;</span><span class="p">,</span><span class="kt">[]</span><span class="p">)}})</span>
<span class="kt">Bang</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;c_bseq79&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">((</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;newrretf78&quot;</span><span class="p">),</span><span class="kt">[]</span><span class="p">)},</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;dseq76&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">((</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;newrret74&quot;</span><span class="p">),</span><span class="kt">[]</span><span class="p">)}})</span>
<span class="kt">Identity</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">,</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;idseq77&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;lret75&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;newrretf66&quot;</span><span class="p">}})</span>
<span class="kt">PiL</span><span class="w"> </span><span class="p">(</span><span class="kt">Tag</span><span class="w"> </span><span class="s">&quot;func&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">([</span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;dseq76&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;newrret74&quot;</span><span class="p">}],[</span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;idseq77&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;lret75&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">}]),</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;c_lseq68&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;lval70&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">}})</span>
<span class="o">...</span>
<span class="kt">Cut</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;c_rseq3&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;rval5&quot;</span><span class="p">},</span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;c_lseq2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;lval4&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">}),</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;retseq0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">}})</span>
<span class="kt">Assign</span><span class="w"> </span><span class="p">(</span><span class="kt">VID</span><span class="w"> </span><span class="s">&quot;m&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">Rule</span><span class="w"> </span><span class="p">{</span><span class="n">top</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sequent</span><span class="w"> </span><span class="p">{</span><span class="n">turnstile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;retseq0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span><span class="kt">EID</span><span class="w"> </span><span class="s">&quot;ret1&quot;</span><span class="p">]},</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nb">()</span><span class="p">})]</span>
</pre></div>
</div>
<p>It’s not great because there is a lot of noise from the record syntax.</p>
<p>Removing all except bottom/top and edge numbers gives a more compact rendering:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">Identity</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">84</span><span class="w"> </span><span class="mi">82</span>
<span class="kt">BangD</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="mi">84</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">81</span>
<span class="kt">PiR</span><span class="w"> </span><span class="p">[</span><span class="n">func</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="mi">82</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">79</span><span class="w"> </span><span class="mi">78</span>
<span class="kt">Bang</span><span class="w"> </span><span class="mi">79</span><span class="w"> </span><span class="mi">78</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">76</span><span class="w"> </span><span class="mi">74</span>
<span class="kt">Identity</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="mi">66</span>
<span class="kt">PiL</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="mi">76</span><span class="w"> </span><span class="mi">74</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">68</span><span class="w"> </span><span class="mi">70</span>
<span class="o">...</span>
<span class="kt">Cut</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span>
<span class="kt">Assign</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
<p>It’s still pretty bad though.</p>
</section>
<section id="better-syntax">
<h3>Better syntax<a class="headerlink" href="#better-syntax" title="Permalink to this heading"></a></h3>
<p>A better syntax is based on naming the nodes rather than the edges. The edges can be identified by slot numbers on the nodes. Furthermore we only have to write the edges of the source nodes (rule tops), the slots on the destination nodes (rule bottoms) can be inferred. Even the arity and levels of the rule bottoms can be inferred from the tops. Finally we drop the record field names as they are always in the same order, the empty <code class="docutils literal notranslate"><span class="pre">Rule</span> <span class="pre">{()}</span></code> of <code class="docutils literal notranslate"><span class="pre">Identity</span></code>, and empty placeholder tuples of <code class="docutils literal notranslate"><span class="pre">Sequent</span></code>. So we end up with:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">2</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangD</span><span class="w">    </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="p">)}},</span>
<span class="mi">3</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiR</span><span class="w">      </span><span class="p">{[(</span><span class="kt">Tag</span><span class="w"> </span><span class="s">&quot;func&quot;</span><span class="p">,{</span><span class="mi">2</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">[]</span><span class="p">,[</span><span class="mi">2</span><span class="o">/</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="p">([</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span><span class="kt">[]</span><span class="p">)})]},</span>
<span class="mi">4</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Bang</span><span class="w">     </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="kt">Level</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">/</span><span class="mi">1</span><span class="p">),</span><span class="kt">[]</span><span class="p">)}},</span>
<span class="mi">5</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">6</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiL</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">{([{</span><span class="mi">4</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">/</span><span class="mi">1</span><span class="p">}],[{</span><span class="mi">5</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="o">/</span><span class="mi">1</span><span class="p">}])},</span>
<span class="mi">7</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">8</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangD</span><span class="w">    </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="mi">1</span><span class="p">)}},</span>
<span class="mi">9</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w">      </span><span class="p">{({</span><span class="mi">8</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="o">/</span><span class="mi">3</span><span class="p">},{</span><span class="mi">6</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="o">/</span><span class="mi">1</span><span class="p">})},</span>
<span class="mi">10</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Bang</span><span class="w">     </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">[(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="o">/</span><span class="mi">1</span><span class="p">)],</span><span class="w"> </span><span class="p">((</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="kt">[]</span><span class="p">)}},</span>
<span class="mi">11</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">12</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiL</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">{([{</span><span class="mi">10</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="o">/</span><span class="mi">2</span><span class="p">}],[{</span><span class="mi">11</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="o">/</span><span class="mi">1</span><span class="p">}])},</span>
<span class="mi">13</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">14</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangD</span><span class="w">    </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">/</span><span class="mi">1</span><span class="p">)}},</span>
<span class="mi">15</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Bang</span><span class="w">     </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">14</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">[(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="o">/</span><span class="mi">1</span><span class="p">)],</span><span class="w"> </span><span class="p">((</span><span class="kt">Level</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="kt">[]</span><span class="p">)}},</span>
<span class="mi">16</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">17</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiL</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">{([{</span><span class="mi">15</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">/</span><span class="mi">2</span><span class="p">}],[{</span><span class="mi">16</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="o">/</span><span class="mi">1</span><span class="p">}])},</span>
<span class="mi">18</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">19</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangD</span><span class="w">    </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="o">/</span><span class="mi">1</span><span class="p">)}},</span>
<span class="mi">20</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w">      </span><span class="p">{({</span><span class="mi">19</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="o">/</span><span class="mi">2</span><span class="p">},{</span><span class="mi">17</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="o">/</span><span class="mi">1</span><span class="p">})},</span>
<span class="mi">21</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangC</span><span class="w">    </span><span class="p">{{</span><span class="mi">20</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">19</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="o">/</span><span class="mi">1</span><span class="p">]}},</span>
<span class="mi">22</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiR</span><span class="w">      </span><span class="p">{[(</span><span class="kt">Tag</span><span class="w"> </span><span class="s">&quot;func&quot;</span><span class="p">,{</span><span class="mi">21</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">[]</span><span class="p">,[</span><span class="mi">21</span><span class="o">/</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="p">([</span><span class="mi">16</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span><span class="kt">[]</span><span class="p">)})]},</span>
<span class="mi">23</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w">      </span><span class="p">{({</span><span class="mi">22</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="o">/</span><span class="mi">1</span><span class="p">},{</span><span class="mi">12</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="o">/</span><span class="mi">1</span><span class="p">})},</span>
<span class="mi">24</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiR</span><span class="w">      </span><span class="p">{[(</span><span class="kt">Tag</span><span class="w"> </span><span class="s">&quot;func&quot;</span><span class="p">,{</span><span class="mi">23</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">[]</span><span class="p">,[</span><span class="mi">10</span><span class="o">/</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="p">([</span><span class="mi">11</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span><span class="kt">[]</span><span class="p">)})]},</span>
<span class="mi">25</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Bang</span><span class="w">     </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">24</span><span class="o">/</span><span class="mi">1</span><span class="p">),</span><span class="kt">[]</span><span class="p">)}},</span>
<span class="mi">26</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">27</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiL</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">{([{</span><span class="mi">25</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="o">/</span><span class="mi">1</span><span class="p">}],[{</span><span class="mi">26</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="o">/</span><span class="mi">1</span><span class="p">}])},</span>
<span class="mi">28</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">29</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangD</span><span class="w">    </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="o">/</span><span class="mi">1</span><span class="p">)},</span>
<span class="mi">30</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Bang</span><span class="w">     </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">29</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">[(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">29</span><span class="o">/</span><span class="mi">1</span><span class="p">)],</span><span class="w"> </span><span class="p">((</span><span class="kt">Level</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">28</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="kt">[]</span><span class="p">)}},</span>
<span class="mi">31</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">32</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiL</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">{([{</span><span class="mi">30</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="o">/</span><span class="mi">2</span><span class="p">}],[{</span><span class="mi">31</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="o">/</span><span class="mi">1</span><span class="p">}])},</span>
<span class="mi">33</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Identity</span><span class="p">,</span>
<span class="mi">34</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangD</span><span class="w">    </span><span class="p">{{(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">33</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">Level</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">33</span><span class="o">/</span><span class="mi">1</span><span class="p">)}},</span>
<span class="mi">35</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w">      </span><span class="p">{({</span><span class="mi">34</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="o">/</span><span class="mi">2</span><span class="p">},{</span><span class="mi">32</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="o">/</span><span class="mi">1</span><span class="p">})},</span>
<span class="mi">36</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangC</span><span class="w">    </span><span class="p">{{</span><span class="mi">35</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">34</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="o">/</span><span class="mi">1</span><span class="p">]}},</span>
<span class="mi">37</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiR</span><span class="w">      </span><span class="p">{[(</span><span class="n">func</span><span class="p">,{</span><span class="mi">36</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">[]</span><span class="p">,[</span><span class="mi">36</span><span class="o">/</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="p">([</span><span class="mi">31</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span><span class="kt">[]</span><span class="p">)})]},</span>
<span class="mi">38</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w">      </span><span class="p">{({</span><span class="mi">37</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">37</span><span class="o">/</span><span class="mi">1</span><span class="p">},{</span><span class="mi">27</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="o">/</span><span class="mi">1</span><span class="p">})},</span>
<span class="mi">39</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Assign</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">{{</span><span class="mi">38</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">[]</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">26</span><span class="o">/</span><span class="mi">3</span><span class="p">]}})</span>
</pre></div>
</div>
</section>
<section id="real-syntax">
<h3>Real syntax<a class="headerlink" href="#real-syntax" title="Permalink to this heading"></a></h3>
<p>An idea of how a real syntax might look:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;and&quot;</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Assign</span><span class="w"> </span><span class="n">d</span>
<span class="w">  </span><span class="n">d</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiR</span>
<span class="w">    </span><span class="o">^</span><span class="n">func</span><span class="w"> </span><span class="nf">\</span><span class="p">[</span><span class="n">e</span><span class="p">],</span><span class="kt">[]</span><span class="o">.</span><span class="w"> </span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="kt">[]</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="n">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">SigmaL</span><span class="w"> </span><span class="n">e</span>
<span class="w">        </span><span class="o">^</span><span class="kt">False</span><span class="w"> </span><span class="o">\.</span><span class="w"> </span><span class="n">f1</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">          </span><span class="n">f1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiR</span>
<span class="w">            </span><span class="o">^</span><span class="n">func</span><span class="w"> </span><span class="nf">\</span><span class="p">[</span><span class="n">g1</span><span class="p">]</span><span class="o">.</span><span class="w"> </span><span class="n">h1</span>
<span class="w">              </span><span class="n">h1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">False</span>
<span class="w">              </span><span class="kt">[]</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangW</span><span class="w"> </span><span class="n">g1</span>
<span class="w">        </span><span class="o">^</span><span class="kt">True</span><span class="w"> </span><span class="o">\.</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">          </span><span class="n">f2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiR</span>
<span class="w">            </span><span class="o">^</span><span class="n">func</span><span class="w"> </span><span class="nf">\</span><span class="n">g2</span><span class="o">.</span><span class="w"> </span><span class="n">h2r</span>
<span class="w">              </span><span class="n">h2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BangD</span><span class="w"> </span><span class="n">g2</span>
<span class="w">                </span><span class="n">h2r</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">h2</span>

<span class="s">&quot;r&quot;</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Assign</span><span class="w"> </span><span class="n">pr</span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Bang</span><span class="w"> </span><span class="n">b</span>
<span class="w">      </span><span class="n">b</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">True</span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w"> </span><span class="n">lr</span>
<span class="w">      </span><span class="n">k</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w"> </span><span class="n">c</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">False</span>
<span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Cut</span><span class="w"> </span><span class="n">d2</span>
<span class="w">          </span><span class="n">d2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Use</span><span class="w"> </span><span class="s">&quot;and&quot;</span>
<span class="w">          </span><span class="p">[(</span><span class="n">l</span><span class="p">,</span>
<span class="w">            </span><span class="n">lr</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">l</span>
<span class="w">          </span><span class="p">)]</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiL</span><span class="w"> </span><span class="o">^</span><span class="n">func</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">[(</span><span class="n">kr</span><span class="p">,</span>
<span class="w">            </span><span class="n">kr</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">k</span>
<span class="w">          </span><span class="p">)]</span>
<span class="w">      </span><span class="p">[(</span><span class="n">p</span><span class="p">,</span>
<span class="w">        </span><span class="n">pr</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">p</span>
<span class="w">      </span><span class="p">)]</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PiL</span><span class="w"> </span><span class="o">^</span><span class="n">func</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">[(</span><span class="n">nr</span><span class="p">,</span>
<span class="w">        </span><span class="n">nr</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="n">n</span>
<span class="w">      </span><span class="p">)}</span>
</pre></div>
</div>
</section>
<section id="c2-syntax">
<h3>C2 syntax<a class="headerlink" href="#c2-syntax" title="Permalink to this heading"></a></h3>
<p>C2’s syntax for sea-of-nodes looks like:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="mi">22</span><span class="w"> </span><span class="kt">ConI</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="o">#</span><span class="n">int</span><span class="kt">:</span><span class="mi">1</span>
<span class="mi">10</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">Parm0:</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">CompTest</span><span class="ow">::</span><span class="n">comp</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">23</span><span class="w"> </span><span class="kt">CmpI</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">CompTest</span><span class="ow">::</span><span class="n">comp</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:</span><span class="mi">2</span>
<span class="mi">24</span><span class="w"> </span><span class="kt">Bool</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="p">[</span><span class="n">le</span><span class="p">]</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">CompTest</span><span class="ow">::</span><span class="n">comp</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:</span><span class="mi">2</span>
<span class="mi">25</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="kt">If</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">P</span><span class="ow">=</span><span class="mf">1.000000</span><span class="p">,</span><span class="w"> </span><span class="kt">C</span><span class="ow">=</span><span class="mf">6701.000000</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">CompTest</span><span class="ow">::</span><span class="n">comp</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:</span><span class="mi">2</span>
<span class="mi">26</span><span class="w"> </span><span class="kt">IfTrue</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mi">38</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="o">#</span><span class="mi">1</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">CompTest</span><span class="ow">::</span><span class="n">comp</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:</span><span class="mi">2</span>
<span class="mi">27</span><span class="w"> </span><span class="kt">IfFalse</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">[[</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="o">#</span><span class="mi">0</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">CompTest</span><span class="ow">::</span><span class="n">comp</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:</span><span class="mi">2</span>
<span class="mi">11</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">Parm1:</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">10</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">Parm0:</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">3</span><span class="w"> </span><span class="kt">Start</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">3</span><span class="w">  </span><span class="mi">5</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">8</span><span class="w">  </span><span class="mi">9</span><span class="w">  </span><span class="mi">10</span><span class="w">  </span><span class="mi">11</span><span class="w"> </span><span class="p">]]</span><span class="w">  </span><span class="o">#</span><span class="p">{</span><span class="mi">0</span><span class="kt">:</span><span class="n">control</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="kt">:</span><span class="n">abIO</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="kt">:</span><span class="n">memory</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="kt">:</span><span class="n">rawptr</span><span class="kt">:BotPTR</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="kt">:</span><span class="n">return_address</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="kt">:</span><span class="n">int</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="kt">:</span><span class="n">int</span><span class="p">}</span>
<span class="mi">23</span><span class="w"> </span><span class="kt">AddI</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kr">_</span><span class="w">  </span><span class="mi">10</span><span class="w">  </span><span class="mi">11</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">]]</span><span class="w">  </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:</span><span class="mi">2</span>
<span class="mi">9</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">ReturnAdr</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">8</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">FramePtr</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">7</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">Memory</span><span class="w">  </span><span class="kt">Memory:</span><span class="w"> </span><span class="o">@</span><span class="kt">BotPTR</span><span class="w"> </span><span class="o">*+</span><span class="n">bot</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="ow">=</span><span class="kt">Bot</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">6</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">I_O</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">5</span><span class="w"> </span><span class="kt">Parm</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="kt">Control</span><span class="w"> </span><span class="o">!</span><span class="n">jvms</span><span class="kt">:</span><span class="w"> </span><span class="kt">X</span><span class="ow">::</span><span class="n">foo1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">bci</span><span class="kt">:-</span><span class="mi">1</span>
<span class="mi">24</span><span class="w"> </span><span class="kt">Return</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">5</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">8</span><span class="w">  </span><span class="mi">9</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="mi">23</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">]]</span>
<span class="mi">0</span><span class="w"> </span><span class="kt">Root</span><span class="w"> </span><span class="o">===</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">24</span><span class="w">  </span><span class="p">[[</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="mi">1</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="n">inner</span>
</pre></div>
</div>
<p>It’s a debug syntax to output the node graph. The node names are supposed to be fixed width but as you can see they didn’t hold to it with <code class="docutils literal notranslate"><span class="pre">IfTrue</span></code>.</p>
</section>
<section id="normal-order-reduction">
<h3>Normal Order Reduction<a class="headerlink" href="#normal-order-reduction" title="Permalink to this heading"></a></h3>
<p>Looking at the graph for our simple <code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">False</span> <span class="pre">True</span></code> example we can see the general pattern for reduction, at least normal-order leftmost-outermost reduction. We start at the root and go down. The first node we encounter is not a data node SigmaRight / PiRight / etc. (we would stop with WHNF, and evaluate the children with NF), instead it is an identity node. Since there is only one root node, the highest parent of the other side of the identity must be a cut node (unless the root node has a blue input edge). We then reduce this cut node. In this case it disappears and we move up to the PiL-PiR cut node. Here we create two cut nodes, one cuts the PiL near the root and the output of the SigmaL while the other cuts Id-Cut-False and the input of the SigmaL. The cut on the output of the SigmaL is blocked, so we go up the input of the SigmaL and our reduction stack looks like Root -&gt; I -&gt; PiL -&gt; Cut -&gt; SigmaL -&gt; Cut. First we cut the Id and then we cut False-SigmaL. This selects the left PiR with !w/False for our output. We cut this with the PiL with !True, creating a disconnected cut between !True and !w (that is immediately erased) and another cut between our result and the root identity node. We erase the identity and end with our result False.</p>
<p>So the general pattern is, go down red / go up blue until you get to a redex (cut node, dup node)</p>
</section>
</section>
<section id="cut-elimination">
<h2>Cut elimination<a class="headerlink" href="#cut-elimination" title="Permalink to this heading"></a></h2>
<p>For all reductions:</p>
<ul class="simple">
<li><p>Move the two nodes of the cut next to the cut, replacing use with copy-paste</p></li>
</ul>
<p>Identity</p>
<ul class="simple">
<li><p>Copy the cut’s non-identity edge to the non-cut edge that links to the identity node. If the cut has levels then label with (id edge)-&gt;(non-id edge).</p></li>
<li><p>Delete cut and identity</p></li>
</ul>
<p>Matching left/right Pi/Sigma</p>
<ul class="simple">
<li><p>Erase non-matching cases, if any</p></li>
<li><p>Link context variables of matching case with outside variables, if any</p></li>
<li><p>Nodes should have same # of edges. Create cut nodes for each edge-pair.</p></li>
<li><p>Link cut nodes with matching variable on each side.</p></li>
<li><p>Preserve cut’s level numbers (but not active status) for red-red, swap for red-blue</p></li>
<li><p>Delete PiR/PiL nodes</p></li>
</ul>
<p>Promotion/contraction</p>
<ul class="simple">
<li><p>Create duplication nodes for each out-edge of promotion, color=red/blue</p></li>
<li><p>Link duplication nodes, if multiple</p></li>
<li><p>Duplicate !p node and point to duplication node, marking one with arrowhead</p></li>
<li><p>Duplicate cut and point to each side of contraction + !p nodes</p></li>
<li><p>Create new contraction node for each context variable pointing to the two !p’s</p></li>
<li><p>Change references to !p to references to context contraction nodes</p></li>
<li><p>Delete original !c contraction node</p></li>
</ul>
<p>Promotion/Dereliction</p>
<ul class="simple">
<li><p>Replace cut’s blue edge with edge of dereliction</p></li>
<li><p>Move level on cut’s red edge to cut’s blue edge, if not set</p></li>
<li><p>Replace cut’s red edge with red edge of promotion</p></li>
<li><p>For each context edge going into !p, replace edge with !p’s edge</p></li>
<li><p>Delete dereliction and promotion</p></li>
</ul>
<p>Duplication:</p>
<ul class="simple">
<li><p>Duplicate node</p></li>
<li><p>Create duplication node for each out-edge of node, copying edge from node</p></li>
<li><p>Point each copy’s edge to duplication node</p></li>
<li><p>Add arrowheads to one of the copy’s edges (higher number)</p></li>
<li><p>Change dup node’s references to point to node copies, deleting arrowheads &amp; using to disambiguate</p></li>
<li><p>Link duplication nodes / fix links</p></li>
</ul>
<p>Multi-node Duplication:</p>
<ul class="simple">
<li><p>Duplicate nodes &amp; rename</p></li>
<li><p>Fixup node copies to point within themselves</p></li>
<li><p>Create duplication node for each non-active out-edge of node, copying edge from node</p></li>
<li><p>Replace each copy’s non-active edges with edge to duplication node.</p></li>
<li><p>Remove arrowheads from first copy’s non-active edges. Add arrowheads to second copy set’s non-active edges.</p></li>
<li><p>Change dup node’s references to point to node copies, deleting arrowheads &amp; using arrowheads to disambiguate</p></li>
<li><p>Link duplication nodes / fix links</p></li>
</ul>
<p>Dup-Id-Dup:</p>
<ul class="simple">
<li><p>Duplicate identity node</p></li>
<li><p>Replace references to dup nodes with identity reference (odot=higher)</p></li>
<li><p>Delete duplication nodes and links</p></li>
<li><p>For !w/?w we delete the rule with ! and create no cuts.</p></li>
<li><p>To eliminate <span class="math notranslate nohighlight">\(\forall\)</span> or <span class="math notranslate nohighlight">\(\exists\)</span>, we extend the variable substitution to the other side.</p></li>
<li><p>The commuting cases are mostly handled by our graph formalism; cuts on the context are pushed down to where they apply. But for PiRight/SigmaLeft there can be a cut on the context variables. To push it down we need to duplicate the cut and its other side for each case. Of course, if there are only 0/1 cases, there is no duplication. But in general we need to introduce a phi-duplication node; when the phi-dup node encounters an identity it adds the edge from the other side to the context variables. Overall commuting deletes code or exposes more reduction opportunities. There is also the potential to reverse-commute and deduplicate part of the cases, if they are the same.</p></li>
<li><p>To expand identities, start with PiRight/SigmaLeft, then use the opposite rule on the opposite side for each case, and terminate with identities. But actually we should prefer to contract identities, searching for expanded identities and replacing them with identities on larger types.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Concurrency.html" class="btn btn-neutral float-left" title="Concurrency" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Dispatch.html" class="btn btn-neutral float-right" title="Dispatch" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022 Mathnerd314.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>