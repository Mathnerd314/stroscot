<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Time API &mdash; Stroscot  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/hexagon_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Types" href="Types.html" />
    <link rel="prev" title="Term rewriting" href="TermRewriting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/hexagon_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HowTo/index.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/index.html">Language Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Commentary</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Assembly.html">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="BuildSystem.html">Build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="Checklist.html">Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="Code-Generation.html">Code generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Compiler.html">Compiler design</a></li>
<li class="toctree-l2"><a class="reference internal" href="CompilerOutput.html">Compiler output</a></li>
<li class="toctree-l2"><a class="reference internal" href="Concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="CoreSyntax.html">Core syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="Dispatch.html">Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="Evaluation-Strategy.html">Evaluation strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="Exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fastest.html">As fast as C</a></li>
<li class="toctree-l2"><a class="reference internal" href="IR.html">Control flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="IR.html#blocks">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="IR.html#id1">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="IR.html#ir-style">IR Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="Intrinsics.html">Intrinsics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Library.html">Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="Logic.html">Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="LogicProgramming.html">Logic programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="Memory-Management.html">Memory management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Meta.html">Meta</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="Objects.html">Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="PackageManager.html">Package manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="Posets.html">Posets</a></li>
<li class="toctree-l2"><a class="reference internal" href="Programs.html">Exemplary programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reduction.html">Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reduction-Example.html">Reduction example</a></li>
<li class="toctree-l2"><a class="reference internal" href="Resource-Management.html">Resource management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sets.html">Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="State.html">Stateful programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Syntax.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="TermRewriting.html">Term rewriting</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Time API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#instant">Instant</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-standards">Time standards</a></li>
<li class="toctree-l3"><a class="reference internal" href="#epochs">Epochs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#epoch-relative-time">Epoch-relative time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-record">Time record</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#other-calendars">Other calendars</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#duration">Duration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partial-date">Partial date</a></li>
<li class="toctree-l3"><a class="reference internal" href="#intervals">Intervals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recurrence">Recurrence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#format-information">Format information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-zones">Time zones</a></li>
<li class="toctree-l3"><a class="reference internal" href="#libraries">Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#os-interface">OS interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="Units.html">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="Verification.html">Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../zzreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Stroscot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Commentary</a></li>
      <li class="breadcrumb-item active">Time API</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/Mathnerd314/stroscot/edit/master/docs/Commentary/Time.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="time-api">
<h1>Time API<a class="headerlink" href="#time-api" title="Permalink to this heading"></a></h1>
<section id="instant">
<h2>Instant<a class="headerlink" href="#instant" title="Permalink to this heading"></a></h2>
<p>An instant marks a proper time (real number) as measured by some observer.  Although relativity means not all events can be given a time as they happened with space-like separation from the observer, the speed of light is quite fast so most events on a human-level timescale do have timelike separation.</p>
<p>A timescale T is a one-to-one function of the proper time, i.e. each instant corresponds to a value on the timescale.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">set</span><span class="w"> </span><span class="kt">Instant</span><span class="w"></span>

<span class="nf">timescale</span><span class="w"> </span><span class="n">subset</span><span class="w"> </span><span class="kt">Instant</span><span class="w"></span>
</pre></div>
</div>
<p>In Python’s terminology a timescale value is “aware”, but Python also considers bare times like <code class="docutils literal notranslate"><span class="pre">10:34</span> <span class="pre">AM</span></code> with a UTC offset to be aware, which is pretty weird because you can’t convert it to a proper time without the day.</p>
<p>Timescales can be converted to each other, just convert to and from proper time or (practically) to and from a well-known timescale such as TAI.</p>
</section>
<section id="time-standards">
<h2>Time standards<a class="headerlink" href="#time-standards" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>International Atomic Time (TAI)</p></li>
<li><p>Terrestrial Time (TT)</p></li>
<li><p>GPS time (GPS)</p></li>
<li><p>Barycentric Coordinate Time (TCB)</p></li>
<li><p>Geocentric Coordinate Time (TCG)</p></li>
<li><p>Barycentric Dynamical Time (TDB)</p></li>
<li><p>Universal Time (UT1)</p></li>
<li><p>True solar time at prime meridian (TST)</p></li>
<li><p>Local true solar time at longitude l (LTST l)</p></li>
<li><p>UTC</p></li>
<li><p>UTC offset UTC±[hh]:[mm], <code class="docutils literal notranslate"><span class="pre">Offset</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">hours</span> <span class="pre">:</span> <span class="pre">range_exclusive</span> <span class="pre">-24</span> <span class="pre">24,</span> <span class="pre">minutes</span> <span class="pre">:</span> <span class="pre">range</span> <span class="pre">0</span> <span class="pre">60}</span></code></p></li>
<li><p>Civil timezone with <code class="docutils literal notranslate"><span class="pre">TimeZoneId</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">id</span> <span class="pre">:</span> <span class="pre">String</span> <span class="pre">|</span> <span class="pre">lookupZoneRules</span> <span class="pre">id</span> <span class="pre">:</span> <span class="pre">ZoneRules</span> <span class="pre">}</span></code></p></li>
<li><p>Google/AWS smeared UTC</p></li>
<li><p>UTC-SLS or UTS smeared UTC</p></li>
<li><p>Bloomberg smeared UTC</p></li>
</ul>
<p>A standard defines a way of marking time, including the length of a second and of a day. The lengths can vary, making a nonlinear transformation to proper time. TCG, TT, TAI, GPS, UT1 and TST have a fixed day length of 86400 seconds; for UT1/TST this corresponds is one rotation of the Earth, while for TCG/TT/TAI/GPS it is simply a nominal day. The nominal day is shorter than the time for a full Earth rotation, and it is somewhat misleading to use such day-based notations because they are not connected to the solar day, but it is conventional practice nonetheless. UTC uses a varying day of 86400 plus or minus a second. Civil time varies like UTC and also has daylight savings time and other zone transitions making the day length vary by hours.</p>
<p>For measuring durations, TAI, TT, or GPS is best because the second is uniform and based on the SI definition. Although Linux’s CLOCK_MONOTONIC is close, NTP’s corrections become important over longer time scales. NTP errors can be between 2ms-100ms depending on connectivity. For astronomical calculations UT1, TST, and LTST are best. TCG, TCB, TDB are rare standards and do not need to be implemented in the standard library.</p>
<p>UTC’s only real advantage is its ubiquity - there are lookup tables (leap second table, DUT1) and formulas to convert UTC to other standards. Smeared UTC is its own thing, even more contrived than UTC.</p>
</section>
<section id="epochs">
<h2>Epochs<a class="headerlink" href="#epochs" title="Permalink to this heading"></a></h2>
<p>The simplest method of specifying an instant is to give it a name. A named instant is called an epoch. There are numerous epochs, too many to list here. The epochs may be a fixed instant in a given standard, such as the GPS epoch, or be dependent on a time standard to interpret as an instant, such as Rata Die.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">FixedEpoch</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Instant</span><span class="w"></span>
<span class="kt">CalendarEpoch</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Standard</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Instant</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="epoch-relative-time">
<h2>Epoch-relative time<a class="headerlink" href="#epoch-relative-time" title="Permalink to this heading"></a></h2>
<p>The form of specifying time most convenient for calculations is as a quantity of time elapsed relative to some particular epoch, where the quantity is a number and some time unit. The time standard must also be specified to fix the length of the time unit. So it looks as follows:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">EpochTime</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">ChronoField</span><span class="p">,</span><span class="w"> </span><span class="n">epoch</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Epoch</span><span class="p">,</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">TimeStandard</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="kt">EpochTime</span><span class="w"> </span><span class="mi">14247</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="kt">UnixEpoch</span><span class="w"> </span><span class="kt">UTC</span><span class="w"> </span><span class="c1">-- 14247 days after Unix epoch</span><span class="w"></span>
</pre></div>
</div>
<p>The unit is a singular ChronoField, because a real number times one field is sufficient to express any instant. For multiple fields use a time record or tuple of time duration and epoch.</p>
<p>Epoch times using days as the unit are called epoch dates. JD and MJD are common epoch date formats.</p>
</section>
<section id="time-record">
<h2>Time record<a class="headerlink" href="#time-record" title="Permalink to this heading"></a></h2>
<p>A time record specifies an instant using a collection of fields from the proleptic Gregorian calendar (ISO 8601), implicitly using the Rata Die epoch. The time standard must also be specified.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">AdjustField</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="kt">InLeapSecond</span><span class="p">,</span><span class="w"> </span><span class="kt">TAIOffset</span><span class="p">,</span><span class="w"> </span><span class="kt">InDST</span><span class="p">,</span><span class="w"> </span><span class="kt">UTCHourOffset</span><span class="p">,</span><span class="w"> </span><span class="kt">Fold</span><span class="p">}</span><span class="w"></span>

<span class="kt">ChronoField</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="kt">Nanosecond</span><span class="p">,</span><span class="w"> </span><span class="kt">Microsecond</span><span class="p">,</span><span class="w"> </span><span class="kt">Millisecond</span><span class="p">,</span><span class="w"> </span><span class="kt">Second</span><span class="p">,</span><span class="w"> </span><span class="kt">Minute</span><span class="p">,</span><span class="w"> </span><span class="kt">Hour</span><span class="p">,</span><span class="w"> </span><span class="kt">Half_Day</span><span class="p">,</span><span class="w"> </span><span class="kt">Day</span><span class="p">,</span><span class="w"> </span><span class="kt">WeekDay</span><span class="p">,</span><span class="w"> </span><span class="kt">Week</span><span class="p">,</span><span class="w"> </span><span class="kt">Month</span><span class="p">,</span><span class="w"> </span><span class="kt">Quarter</span><span class="p">,</span><span class="w"> </span><span class="kt">Year</span><span class="p">,</span><span class="w"> </span><span class="kt">JulianAstroYear</span><span class="p">,</span><span class="w"> </span><span class="kt">BesselianAstroYear</span><span class="p">,</span><span class="w"> </span><span class="kt">Decade</span><span class="p">,</span><span class="w"> </span><span class="kt">Century</span><span class="p">,</span><span class="w"> </span><span class="kt">Millennium</span><span class="p">,</span><span class="w"> </span><span class="kt">Era</span><span class="p">}</span><span class="w"> </span><span class="n">union</span><span class="w"> </span><span class="kt">AdjustField</span><span class="w"></span>


<span class="c1">-- convertible to integers</span><span class="w"></span>
<span class="kt">DayOfWeek</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Monday</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="kt">Sunday</span><span class="w"></span>
<span class="kt">Month</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">January</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="kt">December</span><span class="w"></span>
<span class="kt">Era</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">BC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kt">AD</span><span class="w"></span>

<span class="kt">TimeRecord</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Map</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="p">(</span><span class="kt">Real</span><span class="o">|</span><span class="kt">DayOfWeek</span><span class="o">|</span><span class="kt">Month</span><span class="o">|</span><span class="kt">Era</span><span class="p">),</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Standard</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="kt">NormalizedTimeRecord</span><span class="w"> </span><span class="n">subset</span><span class="w"> </span><span class="kt">TimeRecord</span><span class="w"></span>
</pre></div>
</div>
<p>An un-normalized time record may have any real value for any of the fields, except for era for which only two values are defined (similar to a sign bit). Normalization calculates an instant as the sum associated left from least precise to most precise, e.g. <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">year</span> <span class="pre">=</span> <span class="pre">2006.6,</span> <span class="pre">month</span> <span class="pre">=</span> <span class="pre">0,</span> <span class="pre">day</span> <span class="pre">=</span> <span class="pre">3</span> <span class="pre">}</span></code> gives <code class="docutils literal notranslate"><span class="pre">((RataDie</span> <span class="pre">+</span> <span class="pre">2006.6*year)+0*month)+3*day</span></code>.</p>
<p>After normalization the range and type of the fields of the result depend on which fields were included. The most precise field is a real in some range, while the other fields are integers, and the least precise field besides era is unbounded. There are also special types for some fields. And some fields are conventionally 1-indexed. The BC era is numbered backwards. Some examples:
* year : int, month : Month, day : range int 1 32, hour : range real 0 24
* year : int, day : range real 1 367
* year : int, week : range int 1 54, day : DayOfWeek
* decade : int, year : range int 0 10, day : range real 1 367
* century : int, decade : range int 0 10, year : range int 0 10, day : range real 1 367
* century : real
* day : real
* era : Era, year : range real 1 infinity</p>
<p>Since the range and type varies there is an API to compute it:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">NormalizedRange</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">minSmallest</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">maxSmallest</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">minLargest</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">maxLargest</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">real</span><span class="w"></span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">minSmallest</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">minLargest</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxLargest</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">minSmallest</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxSmallest</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxLargest</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="c1">-- only looks at which fields are present</span><span class="w"></span>
<span class="nf">range</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Set</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Map</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="kt">NormalizedRange</span><span class="w"></span>
<span class="kr">type</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Set</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Map</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="kt">Type</span><span class="w"></span>

<span class="c1">-- looks at values of fields</span><span class="w"></span>
<span class="nf">preciseRange</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">TimeRecord</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Map</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">real</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>For the range, all values are within <code class="docutils literal notranslate"><span class="pre">[minSmallest,</span> <span class="pre">maxLargest)</span></code>, but setting a field to a value outside of <code class="docutils literal notranslate"><span class="pre">[minLargest,</span> <span class="pre">maxSmallest)</span></code> may produce an un-normalized value. To avoid this the precise range can be used, but it is dependent on the values of the less-precise fields (e.g. number of days in a month varies based on the month and year).</p>
<p>Regarding leap seconds in UTC, if none of the adjustment fields are specified, then seconds can have an integer part of 60, representing the leap second. With in_leap_second, it goes <code class="docutils literal notranslate"><span class="pre">[(59,false),(0,true),(0,false)]</span></code>. Similarly fold represents ambiguous times with 0=the earliest time, 1=the next earliest, etc.</p>
<p>For civil time, there is also DST. Without adjustment fields this is represented by varying the number of hours in the day - useful for calculations, but probably not desired for display. InDST represents this unambiguously, or fold may be used - it takes on the value 2 if DST and the leap second overlap (unlikely).</p>
<section id="other-calendars">
<h3>Other calendars<a class="headerlink" href="#other-calendars" title="Permalink to this heading"></a></h3>
<p>There are many other calendars besides Gregorian, e.g.:
* Buddhist, Chinese lunar, Ethiopian, Hindu, Lunar Hijri (Islamic), Solar Hijri, ISO week date
* Akan, Armenian, Assamese, Assyrian, Baháʼí, Balinese pawukon, Balinese saka, Bengali, Bangladeshi, Berber, Borana, Burmese, Coptic, Earthly Branches, Ethiopian,  Heavenly Stems, Minguo, Gaelic, Germanic heathen, Georgian, Hebrew / Jewish, Hindu, Vikram Samvat, Saka, Igbo, Zoroastrian, Fasli, Tabular, Jain, Japanese, Javanese, Korean, Juche, Julian, Kurdish, Lithuanian, Maithili, Malayalam, Mandaean, Mayan long count, Mayan Haab, MAyan Tzolkin, Meitei, Melanau, Mongolian, Nepal Sambat, Bikram Sambat, Yele Sambat, Nisg̱a’a, Odia, Punjabi, Nanakshahi, Romanian, Shona, Solar term, Somali, Sesotho, Slavic, Slavic Native Faith, Macedonian, Tamil, Thai lunar, Thai solar, Tibetan, Tripuri, Tulu, Vietnamese, Wicca, Xhosa, Yoruba, Zulu</p>
<p>These can have their own ChronoFields like <code class="docutils literal notranslate"><span class="pre">Julian_year</span></code>, <code class="docutils literal notranslate"><span class="pre">Japanese_era</span></code>, etc. so there should be a way to extend the list of ChronoFields.</p>
</section>
</section>
<section id="duration">
<h2>Duration<a class="headerlink" href="#duration" title="Permalink to this heading"></a></h2>
<p>A duration identifies a time difference as a collection of time fields. All the fields are real:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">Duration</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Map</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="kt">Real</span><span class="p">,</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Standard</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The length of the fields varies by time standard, so that must also be specified. Although the primary use of a duration is to be added or subtracted from an instant, and some instant formats have standards associated with them which might allow avoiding the standard field in the duration, other instant types such as well-known fixed instants have no standard, so the instant’s standard cannot be used in general.</p>
<p>Examples:
* years, months, days
* months, days
* weeks, days</p>
</section>
<section id="partial-date">
<h2>Partial date<a class="headerlink" href="#partial-date" title="Permalink to this heading"></a></h2>
<p>A partial date is just a collection of time fields, and a list of all of them for the complete date. There is an “update” operation which takes an instant and a partial date that has the semantics of replacing or overriding the fields of the instant with those of the partial date’s, when the instant is expressed as a time record in the given standard.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">PartialDate</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Set</span><span class="w"> </span><span class="kt">ChronoField</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Map</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"> </span><span class="p">(</span><span class="kt">Int</span><span class="o">|</span><span class="kt">Real</span><span class="o">|</span><span class="kt">DayOfWeek</span><span class="o">|</span><span class="kt">Month</span><span class="o">|</span><span class="kt">Era</span><span class="p">),</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Standard</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>For example a POSIX timestamp is a partial date with its InLeapSecond field unspecified.</p>
</section>
<section id="intervals">
<h2>Intervals<a class="headerlink" href="#intervals" title="Permalink to this heading"></a></h2>
<p>Time intervals represent a closed interval <code class="docutils literal notranslate"><span class="pre">[s,e]</span></code> of instants.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">TimeInterval</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Instant</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Instant</span><span class="p">}</span><span class="w"> </span><span class="c1">-- inclusive</span><span class="w"></span>
</pre></div>
</div>
<p>Probably the standard interval type is sufficient.</p>
</section>
<section id="recurrence">
<h2>Recurrence<a class="headerlink" href="#recurrence" title="Permalink to this heading"></a></h2>
<p>This represents a recurrence rule as documented in the iCalendar RFC. (c.f. <a class="reference external" href="https://dateutil.readthedocs.io/en/stable/rrule.html">https://dateutil.readthedocs.io/en/stable/rrule.html</a>)</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">rrule</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">dtstart</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">datetime</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">{</span><span class="kt">YEARLY</span><span class="p">,</span><span class="w"> </span><span class="kt">MONTHLY</span><span class="p">,</span><span class="w"> </span><span class="kt">WEEKLY</span><span class="p">,</span><span class="w"> </span><span class="kt">DAILY</span><span class="p">,</span><span class="w"> </span><span class="kt">HOURLY</span><span class="p">,</span><span class="w"> </span><span class="kt">MINUTELY</span><span class="p">,</span><span class="w"> </span><span class="kt">SECONDLY</span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="o">.</span><span class="w"> </span><span class="n">interval</span><span class="kt">:</span><span class="w"> </span><span class="n">int</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">datetime</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">wkst</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">DayOfWeek</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Map</span><span class="w"> </span><span class="p">{</span><span class="n">bysetpos</span><span class="p">,</span><span class="w"> </span><span class="n">bymonth</span><span class="p">,</span><span class="w"> </span><span class="n">bymonthday</span><span class="p">,</span><span class="w"> </span><span class="n">byyearday</span><span class="p">,</span><span class="w"> </span><span class="n">byweekno</span><span class="p">,</span><span class="w"> </span><span class="n">byweekday</span><span class="p">,</span><span class="w"> </span><span class="n">byhour</span><span class="p">,</span><span class="w"> </span><span class="n">byminute</span><span class="p">,</span><span class="w"> </span><span class="n">bysecond</span><span class="p">,</span><span class="w"> </span><span class="n">byeaster</span><span class="p">}</span><span class="w"> </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="format-information">
<h2>Format information<a class="headerlink" href="#format-information" title="Permalink to this heading"></a></h2>
<p>This is used for pretty-printing and parsing instants.</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">DateTimeFormat</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">printerParser</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">CompositePrinterParser</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Locale</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">decimalStyle</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">DecimalStyle</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">resolverStyle</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">ResolverStyle</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">resolverFields</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Set</span><span class="w"> </span><span class="kt">ChronoField</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Standard</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="kt">FormatStyle</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">Full</span><span class="p">,</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span><span class="w"> </span><span class="kt">Medium</span><span class="p">,</span><span class="w"> </span><span class="kt">Short</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kt">ResolverStyle</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="p">{</span><span class="kt">Strict</span><span class="p">,</span><span class="w"> </span><span class="kt">Smart</span><span class="p">,</span><span class="w"> </span><span class="kt">Lenient</span><span class="p">}</span><span class="w"></span>
<span class="c1">-- strict: reject invalid values</span><span class="w"></span>
<span class="c1">-- smart: day-of-month 32 is clipped to day 30 or 31</span><span class="w"></span>
<span class="c1">-- lenient: month 15 is treated as being 3 months after month 12.</span><span class="w"></span>
<span class="kt">SignStyle</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="p">{</span><span class="kt">Normal</span><span class="p">,</span><span class="w"> </span><span class="kt">Always</span><span class="p">,</span><span class="w"> </span><span class="kt">Never</span><span class="p">,</span><span class="w"> </span><span class="kt">Not_Negative</span><span class="p">,</span><span class="w"> </span><span class="kt">Exceeds_Pad</span><span class="p">}</span><span class="w"></span>
<span class="c1">-- Normal: -1, 2</span><span class="w"></span>
<span class="c1">-- Always: -1, +2</span><span class="w"></span>
<span class="c1">-- Never: 1, 2</span><span class="w"></span>
<span class="c1">-- Not_Negative: exception, 2</span><span class="w"></span>
<span class="c1">-- Exceeds_Pad: Normal but output the sign if the value exceeds the pad width.</span><span class="w"></span>
<span class="c1">-- In lenient parsing, any sign will be accepted unless the width is fixed,</span><span class="w"></span>
<span class="c1">-- with the absence of a sign treated as a positive number.</span><span class="w"></span>
<span class="kt">TextStyle</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="p">{</span><span class="kt">Full</span><span class="p">,</span><span class="w"> </span><span class="kt">Full_Standalone</span><span class="p">,</span><span class="w"> </span><span class="kt">Short</span><span class="p">,</span><span class="w"> </span><span class="kt">Short_Standalone</span><span class="p">,</span><span class="w"> </span><span class="kt">Narrow</span><span class="p">,</span><span class="w"> </span><span class="kt">Narrow_Standalone</span><span class="p">}</span><span class="w"></span>
<span class="c1">-- standalone does not apply to English, but in other languages you have &quot;MarchX&quot; and &quot;MarchY 2, 2003&quot;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="time-zones">
<h2>Time zones<a class="headerlink" href="#time-zones" title="Permalink to this heading"></a></h2>
<p>Civil time standards refer to a time zone database for the UTC offset using a time zone ID string.</p>
<p>A time zone is a list of transitions:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">ZoneOffsetTransition</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">instant</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Instant</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">offsetBefore</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Offset</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">offsetAfter</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Offset</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>At the instant given the offset changes from before to after.</p>
<p>Most transitions follow a regular pattern, so are given by a rule:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">ZoneOffsetTransitionRule</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Month</span><span class="p">,</span><span class="w"> </span><span class="n">dayOfMonth</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">i8</span><span class="p">,</span><span class="w"> </span><span class="n">dow</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">DayOfWeek</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">LocalTime</span><span class="p">,</span><span class="w"> </span><span class="n">timeEndOfDay</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">boolean</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">timeDefinition</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">TimeDefinition</span><span class="p">,</span><span class="w"> </span><span class="n">standardOffset</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">ZoneOffset</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">offsetBefore</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">ZoneOffset</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">offsetAfter</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">ZoneOffset</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>So overall Java uses this thing for a time zone:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kt">ZoneRules</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">standardTransitions</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">Instant</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">standardOffsets</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">ZoneOffset</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">standardOffsets</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">standardTransitions</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">savingsLocalTransitions</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">LocalDateTime</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">savingsLocalTransitions</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">wallOffsets</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">wallOffsets</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">ZoneOffset</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">savingsInstantTransitions</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="n">i64</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">savingsInstantTransitions</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">wallOffsets</span><span class="w"></span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">lastRules</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="p">[</span><span class="kt">ZoneOffsetTransitionRule</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>TODO: Checkout Python zoneinfo, whatever Rust does, etc. for a better API</p>
</section>
<section id="libraries">
<h2>Libraries<a class="headerlink" href="#libraries" title="Permalink to this heading"></a></h2>
<p>The JSR-310 <a class="reference external" href="https://www.threeten.org/">ThreeTen</a> library in <a class="reference external" href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/time/package-summary.html">Java</a> seems to have undergone the most peer review. It relies heavily on ISO 8601. Another is <a class="reference external" href="http://time4j.net/">http://time4j.net/</a>. For some reason these are all Java. Rust has a basic thing in <a class="reference external" href="https://doc.rust-lang.org/std/time/index.html">std</a>. There is a more complete Rust library but the author is <a class="reference external" href="https://github.com/time-rs/time/issues/406#issuecomment-989753838">opinionated</a>.</p>
<p><a class="reference external" href="https://github.com/fifth-postulate/julian">https://github.com/fifth-postulate/julian</a></p>
</section>
<section id="os-interface">
<h2>OS interface<a class="headerlink" href="#os-interface" title="Permalink to this heading"></a></h2>
<p>A few functions:
* guess civil time standard of the system (it’s a guess because the system could be crazy)
* get the current system time as an instant (possible because OS’s have leap second APIs to allow converting to TAI)</p>
<p>System time formats are generally instants, but some don’t specify enough information or are durations.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="TermRewriting.html" class="btn btn-neutral float-left" title="Term rewriting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Types.html" class="btn btn-neutral float-right" title="Types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022 Mathnerd314.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>