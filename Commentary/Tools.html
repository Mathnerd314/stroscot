<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tools &mdash; Stroscot  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/hexagon_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Types" href="Types.html" />
    <link rel="prev" title="Time API" href="Time.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/hexagon_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HowTo/index.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/index.html">Language Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Commentary</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Assembly.html">Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="BuildSystem.html">Build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="Checklist.html">Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="Code-Generation.html">Code generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Compiler.html">Compiler design</a></li>
<li class="toctree-l2"><a class="reference internal" href="Compiler-Library.html">Compiler library</a></li>
<li class="toctree-l2"><a class="reference internal" href="CompilerOutput.html">Compiler output</a></li>
<li class="toctree-l2"><a class="reference internal" href="Concurrency.html">Concurrency</a></li>
<li class="toctree-l2"><a class="reference internal" href="CoreSyntax.html">Core syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="Dispatch.html">Dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="Errors.html">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="Evaluation-Strategy.html">Evaluation strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="Exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fastest.html">As fast as C</a></li>
<li class="toctree-l2"><a class="reference internal" href="IR.html">Intermediate representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Intrinsics.html">Intrinsics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Learning.html">Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="Logic.html">Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="LogicProgramming.html">Logic programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="Memory-Management.html">Memory management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Meta.html">Meta</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="Objects.html">Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="PackageManager.html">Package manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="Parsing.html">Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Posets.html">Posets</a></li>
<li class="toctree-l2"><a class="reference internal" href="Profiling.html">Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Programs.html">Exemplary programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reduction.html">Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reduction-Example.html">Reduction example</a></li>
<li class="toctree-l2"><a class="reference internal" href="Resource-Management.html">Resource management</a></li>
<li class="toctree-l2"><a class="reference internal" href="Security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sets.html">Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="Standard-Library.html">Standard library</a></li>
<li class="toctree-l2"><a class="reference internal" href="State.html">Stateful programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Syntax.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="TermRewriting.html">Term rewriting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Time.html">Time API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#style-checker">Style checker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-harness">Testing harness</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation-generator">Documentation generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refactorer-reformatter">Refactorer/reformatter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interactive-shell">Interactive shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ide-support">IDE support</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#language-server">Language server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notebooks">Notebooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugger">Debugger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="Units.html">Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="Verification.html">Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../zzreferences.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Stroscot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Commentary</a></li>
      <li class="breadcrumb-item active">Tools</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/Mathnerd314/stroscot/edit/master/docs/Commentary/Tools.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tools">
<h1>Tools<a class="headerlink" href="#tools" title="Permalink to this heading"></a></h1>
<p>Nowadays every language comes with a tool suite, because a compiler alone is not enough. As Walter Bright points out, if it’s a separate download, what happens is people never use it. A third-party tool is never installed, or it’s the wrong version. Users do not want to read the manual for a third party tool and will never consider using it. But when it’s built into the language, they magically start using it. And there’s synergies, like you can integrate the documentation with the style checker and stuff like that. The tools can all be integrated with the compiler and use the same parser, ABI, etc. so that they are always compatible.</p>
<p>Bright says this is transformative - it’s like a night and day difference. And the other advantage is, there’s only one. If you leave it to third parties, you get an endless number of tools, all different. Two teams each pick a different documentation generator and now they can’t be merged or they can’t work together and then you’ll have a big fight and what a waste of time. The built-in tool may not be the best, but it’s always there. By building it in you sort of browbeat people into using it.</p>
<section id="style-checker">
<h2>Style checker<a class="headerlink" href="#style-checker" title="Permalink to this heading"></a></h2>
<p>This is really just compiler warnings - keep adding warnings until no program is safe. But commercial style checking tools have this cool search and filter interface. It would also be cool to prioritize warnings based on machine learning.</p>
</section>
<section id="testing-harness">
<h2>Testing harness<a class="headerlink" href="#testing-harness" title="Permalink to this heading"></a></h2>
<p>I don’t just have unit testing and integration testing, I have model checking and formal verification. But there needs to be some interface for specifying how the model checker is run, like turning off tests and viewing summaries of results.</p>
</section>
<section id="documentation-generator">
<h2>Documentation generator<a class="headerlink" href="#documentation-generator" title="Permalink to this heading"></a></h2>
<p>The documentation generator provides a nice way to browse through a large codebase, ensuring that code is easy-to-read and searchable. The documentation comments, type annotations, and argument names are pulled out for each function, and the implementation code is accessible though an expando. The code has hyperlinks for all terms to the place where they are defined, or opens a menu if the term is overloaded. Code is prettified to use Unicode or MathML formulas where appropriate. There’s regex-based search, and special searches for identifiers. Also useful is the call graph, in particular showing what functions call a given function. This can just be a link.</p>
<p>As far as targeted output formats, only HTML seems particularly important.</p>
<p>The notion of “well-documented” is hard to define. For one person the source code and function names may be sufficient, while for another a tutorial that has no relation to the codebase may be more useful.</p>
<p>If we have good IDE integration that exposes doc comments then maybe a documentation generator is not too important.</p>
</section>
<section id="refactorer-reformatter">
<h2>Refactorer/reformatter<a class="headerlink" href="#refactorer-reformatter" title="Permalink to this heading"></a></h2>
<p>The refactoring tool reads a program from source file(s), rewrites the code according to specified rules, and writes the program back to the file(s). It automates easy, repetitive, tedious changes. When the need for a rewrite can be detected but it cannot be done automatically, the rule can insert <code class="docutils literal notranslate"><span class="pre">TODO:</span> <span class="pre">check</span> <span class="pre">rule</span> <span class="pre">XXX</span></code> markers. Refactoring provides a way to rename or inline functions, eliminate dead code, and transform old idioms to new idioms. Integrating refactoring with the language allows automated migration of code from old to new versions of libraries, as in gofix. Unlike gofix, the refactoring tool should be more like a library than a program, because writing gofix rules is just too hard. Gofix mainly implements a template style - find this AST pattern, replace with this template - but its pattern language is not very powerful.</p>
<p>With no rewrite rules, the refactoring tool simply reads the code and writes it back out, functioning as a reformatter. Regarding style configurability, there is a continuum. <a class="reference external" href="https://go.dev/blog/gofmt">gofmt</a> is probably the most extreme - it has 0 style-related configuration options. Slightly higher in the continuum is Python’s Black, an “opinionated” and “uncompromising” formatter which has a “purposefully limited” selection of options - really just line length and “magic trailing commas” that avoid collapsing lists onto one line. At the other end are tools like clang-format and GNU indent which have 154 and 82 options respectively. The gofmt page claims that its output is “uncontroversial” but there actually have been many discussions on <a class="reference external" href="https://github.com/golang/go/issues/40028">its lack of configurability</a>, <a class="reference external" href="https://www.reddit.com/r/golang/comments/ee4dqn/how_to_make_gofmt_or_go_fmt_use_whitespaces/">tabs vs spaces</a>, and lack of detailed prettification like <a class="reference external" href="https://www.reddit.com/r/golang/comments/rrce2e/is_there_a_better_alternative_to_gofmt/hqflh4i/">removing whitespace at the head of functions</a> and <a class="reference external" href="https://www.reddit.com/r/golang/comments/rt0hra/can_i_tell_gofmt_to_make_some_exceptions_when/">aligning assignments</a>. It is clear that, contrary to Ian Taylor’s assertion, gofmt is not adequate for everybody. To me, the statement by Ian Taylor “It is an intentional design choice” sounds suspiciously like “I can’t be arsed to implement that”, a sort of concealed indifference as to what formatting is actually aesthetically pleasing. In contrast, with clang-format’s ever-increasing set of options, <a class="reference external" href="https://github.com/llvm/llvm-project/issues/59729">a single space</a> is a significant issue and actually gets addressed. The configurability of clang-format ensures an attention to detail and resulting improvement in formatting quality that the mono-style of gofmt does not. So I think, similarly to Stroscot at large, functionality must be prioritized above minimalism: the reformatter must be able to generate all code styles, or at least the ones that people care enough to implement. “We are too lazy to maintain this” is not an acceptable reason to reject a style, when it could be necessary for someone’s screen reader or to address other readability or accessibility concerns.</p>
<p>Ian does have a point about eliminating bike shed discussions, but that is IMO separate from the implementation of functionality. One can have a default “standard” or “core” coding style, just like having the default standard library and core API supported by the compiler. Standardization has the same benefits of raising the bikeshedding bar: if your format is really so much better, you should be able to convince the standards committee to switch it in the language-wide config file. Letting the language handle it rather than just the people at your organization is a step up in centralization and really has no downsides. But just because one style is standard doesn’t mean that other styles shouldn’t be accessible - it should be easy to override the language default style if an individual has other preferences. But, if an individual does want to deviate, it should be encouraged to run the reformatter as a checkout/checkin filter, so that repositories store code formatted in the standard style and code on the web still uses the standard format.</p>
</section>
<section id="interactive-shell">
<h2>Interactive shell<a class="headerlink" href="#interactive-shell" title="Permalink to this heading"></a></h2>
<p>A REPL loop based on eval. Available from command line as bare <code class="docutils literal notranslate"><span class="pre">stroscot</span></code> or <code class="docutils literal notranslate"><span class="pre">stroscot</span> <span class="pre">-i</span> <span class="pre">files</span></code>, and from API as a library function <code class="docutils literal notranslate"><span class="pre">replLoop</span> <span class="pre">env</span></code> or similar. Supports expressions and block syntax from the main language, and commands. Commands are built-in functions to the interpreter, like <code class="docutils literal notranslate"><span class="pre">shell</span> <span class="pre">clear</span></code> which runs <code class="docutils literal notranslate"><span class="pre">clear</span></code> in the shell. Or maybe the syntax should be <code class="docutils literal notranslate"><span class="pre">:shell</span> <span class="pre">clear</span></code> to avoid clashing with whatever is loaded. But namespaces are a thing, <code class="docutils literal notranslate"><span class="pre">repl.shell</span> <span class="pre">clear</span></code>. The syntax will have to be worked out.</p>
<p>Full command list:</p>
<ul class="simple">
<li><p>shell, run shell thing</p>
<ul>
<li><p>change/print current directory</p></li>
<li><p>list files</p></li>
</ul>
</li>
<li><p>show information about symbol</p></li>
<li><p>push/pop level of interactive environment (source files are level 0, IE starts at level 1, and more can be added)</p></li>
<li><p>clear definitions for specified symbols or current level of interactive environment</p></li>
<li><p>load file</p></li>
<li><p>dump/load interactive environment to/from text file</p></li>
<li><p>reset - clear IE, load sources file from disk</p></li>
<li><p>reload - dump IE, load sources file from disk, load IE dump</p></li>
<li><p>quit process</p></li>
<li><p>debugger commands</p></li>
<li><p>profiler commands</p></li>
</ul>
</section>
<section id="ide-support">
<h2>IDE support<a class="headerlink" href="#ide-support" title="Permalink to this heading"></a></h2>
<p>A GUI interface is higher-bandwidth than the REPL. Typically an IDE allows editing text files but more recently there is the notebook interface which integrates the REPL format with multiline code and allows outputting images, graphs, and interactive components (which would require separate windows when running a text file and command line).</p>
<p>Gilad Bracha says existing workspaces are missing many important features. He recommends writing a new workspace environment from scratch - he thinks 5 full-time people for 2-3 years could do it. But of course he’s a bit biased since he led a team to do such a thing that got their funding pulled 1 year before completion. I think his experience and the deaths of other projects such as e.g. Light Table suggests that writing a new workspace environment is risky. You need a good cross-platform GUI library to even think about it - there is the Dart library, but maybe our port of that will suck. We could take a shortcut by using HTML and a browser engine, but IMO the massive web rendering stack introduces just a bit too much latency. Also, it seems impossible to implement the “tablike spaces” idea I had for an IDE with proportional fonts - I don’t think table layout in HTML is performant enough to do one character per cell. (TODO: actually benchmark this with a hardcoded prototype) It’s kind of a chicken-egg problem - you need an IDE to write code, but writing a new IDE requires writing code.</p>
<p>According to the <a class="reference external" href="https://survey.stackoverflow.co/2022/#section-most-popular-technologies-integrated-development-environment">StackOverflow 2022 survey</a>, VSCode was the most popular editor and 2x as popular as either of the next two, Visual Studio and IntelliJ. I think VSCode is a sufficient environment for hosting a new language, while the existing tools for writing IDEs are insufficient, so implementing the language comes first. So, at least until the language is stable, I only aim to support VSCode / LSP and nothing else.</p>
<section id="language-server">
<h3>Language server<a class="headerlink" href="#language-server" title="Permalink to this heading"></a></h3>
<p>VSCode comes with an extensive protocol for language integration, LSP. Other IDEs do support LSP to some extent, but generally not fully and you have to install plugins. There’s a <a class="reference external" href="https://microsoft.github.io/language-server-protocol/specification">specification</a>. As an overview, an LSP server can provide:</p>
<ul class="simple">
<li><p>syntax highlighting (the docs say you have to use TextMate grammars too, but I think LSP alone is actually performant enough)</p></li>
<li><p>tooltips</p></li>
<li><p>autocomplete suggestions</p></li>
<li><p>navigation outline</p></li>
<li><p>debugger integration</p></li>
<li><p>navigate to definition</p></li>
<li><p>compiler errors/warnings/fixes</p></li>
<li><p>renaming or refactoring actions</p></li>
</ul>
</section>
<section id="notebooks">
<h3>Notebooks<a class="headerlink" href="#notebooks" title="Permalink to this heading"></a></h3>
<p>Ideally, IMO, notebooks would be incremental. Running (shift-enter) would act as if it reran the notebook from the start up to the selected cell. For speed the computation would be cached incrementally, so long-running computations would be skipped if possible. This model allows putting interactive sliders in and quickly updating graphs. Also, like Smalltalk the workspaces should have memory and persist across close-open. Everything in the notebook state should be serialized, down to the cursor position. Ideally this should be a text-based format, JSON or maybe even a subset of Stroscot. Also it should be possible to export a notebook to a text file, once you’ve decided it’s in a good state and don’t need the interactivity anymore.</p>
<p>The modern workspace environment that’s most popular is the Jupyter notebook interface. But jupyter’s kernel <a class="reference external" href="https://jupyter-client.readthedocs.io/en/latest/messaging.html">protocol</a> is just a dumb “execute this string of code” REPL, no information on what cell it’s from. So we would have to hack jupyter to get this to work. OTOH the LSP protocol does support incremental update and it looks like you can use this incremental update protocol with notebooks. So another win for supporting VSCode exclusively.</p>
</section>
</section>
<section id="debugger">
<h2>Debugger<a class="headerlink" href="#debugger" title="Permalink to this heading"></a></h2>
<p>The debugger’s view of the program’s state is as a large expression or term. This state evolves in steps, where each step applies a rule to a redex or calls into the OS to perform a primitive operation.</p>
<p>One debugging technique useful in combination with reversible debugging is to use a step counter that starts at 0 at the beginning of the program and increments every time a reduction step is performed. The exact step that triggers a behavior can be determined by binary search. Similarly when we are debugging a phase of the compiler, we can use “fuel” - this specifies how many transformations can be performed during the phase of interest before moving on to the next phase.</p>
<p>Let’s assume we have symbols, then there are lots of operations available from a debugger:</p>
<ul class="simple">
<li><p>recording: record the whole program execution. Reversible debugging allows running a program backwards. Omniscient debugging allows queries over the entire execution of the program, as though all states were stored in a database and indexed. Recording can be implemented by instruction-level recording, but more efficient is to record only non-deterministic events, with occasional whole-program snapshots to allow seeking. Supporting concurrent execution requires recording inter-thread sequencing.</p></li>
<li><p>breakpoints: set/clear/list. essentially a breakpoint is a true/false predicate on a transition. Can inspect state and the previous state - common conditions include at program line/column, transition calls syscall, transition enters function, expression not yet evaluated, transition invokes signal handler, variable has value in state, transition modifies variable, transition in certain thread.</p></li>
<li><p>tracepoints: record message / data / statistics at a set of program transitions, like a breakpoint but without stopping</p></li>
<li><p>queries: print backtrace / call stack, print state (threads, variables), dump memory, disassemble memory, blocked thread dependencies, pretty-printing, GUI visualizations</p></li>
<li><p>stepping: single step, step out, continue thread / all threads until breakpoint, run ignoring breakpoints until stopped with interactive commnad</p></li>
<li><p>REPL / patching: evaluate pure expression in context of state, evaluate arbitrary code in current state (e.g. set variable to value), replace definition, hot-reload code changes, jump to address, return early from function. Pedantically, the patched state has no real history so the debugger should only be able to run forward from the state, but we can graft the patched state onto the old state to avoid losing context.</p></li>
<li><p>IPC: send signal, modify files</p></li>
</ul>
<p>Debugging by querying a database of all program state by Kyle Huey
The State Of Debugging in 2022 by Robert O’Callahan
Debugging Backwards in Time (2003) by Bil Lewis
undo.io UDB
rr, WinDBG, Pernosco.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Time.html" class="btn btn-neutral float-left" title="Time API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Types.html" class="btn btn-neutral float-right" title="Types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022 Mathnerd314.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>