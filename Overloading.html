

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overloading &mdash; Stroscot  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Types" href="Types.html" />
    <link rel="prev" title="Syntax" href="Syntax.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Stroscot
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Arguments.html">Argument passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Delimited-Continuations.html">Delimited continuations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Optimal-Reduction.html">Optimal reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Syntax.html">Syntax</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overloading</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sequential-matches">Sequential matches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#patterns">Patterns</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="Memory.html">Memory management</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Stroscot</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Overloading</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/Mathnerd314/stroscot/edit/master/docs/Overloading.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overloading">
<h1>Overloading<a class="headerlink" href="#overloading" title="Permalink to this headline">¶</a></h1>
<p>Stroscot supports typical pattern matching and predicate dispatch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">f</span> <span class="mi">1</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">f</span> <span class="n">x</span> <span class="mi">2</span> <span class="k">with</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>The cases are not ordered, instead they are matched most-specific to least-specific. Specificity is defined by an SMT solver, i.e. SAT(a &amp; not b) and UNSAT (not a &amp; b) means that a is less specific than b.</p>
<p>If there is a tie regarding specificity, e.g. we were to modify the last case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">f</span> <span class="mi">1</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">f</span> <span class="n">x</span> <span class="mi">2</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">f</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="c1"># Error: rule conflict</span>
</pre></div>
</div>
<p>Then it is an error.</p>
<p>However, cases that overlap but produce the same result are allowed.
It could be useful for tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fib</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fib</span> <span class="mi">0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">fib</span> <span class="n">n</span> <span class="o">=</span> <span class="n">fib</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># test</span>
<span class="n">fib</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>The implementation is similar to that used for checking equality of dependent types, i.e. it does some normalization but isn’t omniscient. The optimizer decides which case is dead code and can be dropped.</p>
<p>Idea: predicate failure as a throwing operation, and have something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>call binds args = do
 fold lub DispatchError (map ($args) binds)
</pre></div>
</div>
<p>where lub is from <a class="reference external" href="http://conal.net/blog/posts/merging-partial-values">http://conal.net/blog/posts/merging-partial-values</a> and <a class="reference external" href="http://conal.net/blog/posts/merging-partial-values">http://conal.net/blog/posts/merging-partial-values</a>, extended to work on continuations (and unamb is implemented in a deterministic manner using a termination checker instead of racing).</p>
<div class="section" id="sequential-matches">
<h2>Sequential matches<a class="headerlink" href="#sequential-matches" title="Permalink to this headline">¶</a></h2>
<p>The pipe syntax matches cases from top to bottom:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span>
<span class="o">|</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">|</span> <span class="mi">1</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">|</span> <span class="n">x</span> <span class="mi">2</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>It expands to something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">|</span> <span class="n">p1</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">f</span> <span class="o">|</span> <span class="n">p2</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">f</span> <span class="o">|</span> <span class="n">p3</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># p1, p2, etc. functions of $args</span>
</pre></div>
</div>
<p>Maybe you will also be able to use match within a function, if the syntax works out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">match</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="mi">5</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="n">x</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
                      <span class="o">|</span> <span class="mi">1</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="patterns">
<h2>Patterns<a class="headerlink" href="#patterns" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="c1"># matches anything</span>
<span class="n">a</span> <span class="c1"># matches anything and binds a</span>
<span class="o">^</span><span class="n">a</span> <span class="c1"># matches the atom a</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">}]</span> <span class="c1"># literal matching itself</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="c1"># matches any list starting with 1</span>
<span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">:</span> <span class="n">rest</span><span class="p">}</span> <span class="c1"># matches a and the rest of the record</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">pat</span> <span class="c1"># matches both patterns simultaneously</span>
<span class="n">pat</span> <span class="ow">or</span> <span class="n">pat</span> <span class="c1"># matches either pattern</span>
</pre></div>
</div>
<p>Guards allow arbitrary functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="k">with</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p>View patterns</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">f</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>Functions patterns</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Int</span> <span class="n">z</span> <span class="o">=</span> <span class="n">toInteger</span> <span class="n">z</span>

<span class="n">Int</span> <span class="n">a</span>
</pre></div>
</div>
<p>Pattern synonyms</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pattern</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>
</pre></div>
</div>
<p>Arbitrary patterns</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_f</span> <span class="n">a</span> <span class="c1"># matches any function application</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Types.html" class="btn btn-neutral float-right" title="Types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Syntax.html" class="btn btn-neutral float-left" title="Syntax" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2020 Mathnerd314

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>